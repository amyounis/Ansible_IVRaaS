---


EXTRACT_DIR: "/images/IVRaaS_{{IVRAAS_VERSION}}"

WEB_APP_BASE: "/opt/application/ivraas/{{IVRAAS_VERSION}}/webapps"

WEB_LOG_BASE: "/opt/application/ivraas/{{IVRAAS_VERSION}}/logs"

APACHE_CONF: "/opt/application/ivraas/{{IVRAAS_VERSION}}/apache2215/conf.d"

TOMCAT_CONF: "/opt/application/ivraas/{{IVRAAS_VERSION}}/tomcat/00/conf"



WEB_APPS:
 - { name: gv-admmsgvocale-svi  , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.0}}" , vhost: gv-admmsgvocale-svi-amea.dmz.cloud.mbs }
 - { name: gv-authent           , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.1}}" , vhost: "{{URL}}"  		                  } 
 - { name: gv-provisioning      , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.2}}" , vhost: gv-provisioning-amea.dmz.cloud.mbs     }
 - { name: gv-switchingservice  , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.3}}" , vhost: gv-switchingservice-amea.dmz.cloud.mbs }
 - { name: gv-webservices       , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.4}}" , vhost: gv-webservices-amea.dmz.cloud.mbs      }
 - { name: gv-svifiles          , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.5}}" , vhost: gv-svifiles-amea.dmz.cloud.mbs         }
 - { name: gv-admin-stp         , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.6}}" , vhost: "{{URL}}"         		          }
 - { name: gv-adv               , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.7}}" , vhost: "{{URL}}"         		          }    
 - { name: gv-stats             , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.8}}" , vhost: "{{URL}}"          		          }    
 - { name: gv-vocalmestre       , version: "{{hostvars['localhost'].WEBAPPS_VERSIONS.9}}" , vhost: "{{URL}}"           		          }


WAS_FILE:
 - { dest: /mntcvf/web_rw/gv-data/mevo  			, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: /mntcvf/web_rw/gv-data/services  			, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: /mntcvf/web_rw/gv-data/statistiques  		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: /mntcvf/web_rw/gv-data/offers	  		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_LOG_BASE}}"			  		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "/images/IVRaaS_{{IVRAAS_VERSION}}"  		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}/ROOT"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/ROOT"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}/ROOT"	 	, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}/ROOT"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}/ROOT"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.5.name}}/ROOT"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/admin-stp"	, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/stats"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1"		, state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/vocalmestre1"  , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.0.vhost}}"      , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.1.vhost}}"      , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.2.vhost}}"      , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.3.vhost}}"      , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.4.vhost}}"      , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.5.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }
 - { dest: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}" 	        , state: directory , owner: ivruser , group: ivrgroup }



WAS_TEMPLATE:
 - { src: mod_jk.conf.j2 	      , dest: "{{APACHE_CONF}}/mod_jk.conf" 		  , var1: "{{IVRAAS_VERSION}}" }
 - { src: workers.properties.j2       , dest: "{{APACHE_CONF}}/workers.properties" 	  , var1: 9081 }
 - { src: gv-admmsgvocale-svi.conf.j2 , dest: "{{APACHE_CONF}}/{{WEB_APPS.0.vhost}}.conf" , var1: "{{WEB_APPS.0.vhost}}" , var2: "{{WEB_APP_BASE}}" , var3: "{{WEB_APPS.0.name}}" }
 - { src: gv-authent.conf.j2 	      , dest: "{{APACHE_CONF}}/{{WEB_APPS.1.vhost}}.conf" , var1: "{{WEB_APPS.1.vhost}}" , var2: "{{WEB_APP_BASE}}" , var3: "{{WEB_APPS.1.name}}" , var4: "{{DNF_AUTH_URL}}" }
 - { src: gv-provisioning.conf.j2     , dest: "{{APACHE_CONF}}/{{WEB_APPS.2.vhost}}.conf" , var1: "{{WEB_APPS.2.vhost}}" , var2: "{{WEB_APP_BASE}}" , var3: "{{WEB_APPS.2.name}}" , var4: "{{DNF_PROV_URL}}" }
 - { src: gv-switchingservice.conf.j2 , dest: "{{APACHE_CONF}}/{{WEB_APPS.3.vhost}}.conf" , var1: "{{WEB_APPS.3.vhost}}" , var2: "{{WEB_APP_BASE}}" , var3: "{{WEB_APPS.3.name}}" , var4: "{{DNF_SVCS_URL}}" }
 - { src: gv-webservices.conf.j2      , dest: "{{APACHE_CONF}}/{{WEB_APPS.4.vhost}}.conf" , var1: "{{WEB_APPS.4.vhost}}" , var2: "{{WEB_APP_BASE}}" , var3: "{{WEB_APPS.4.name}}" }
 - { src: gv-svifiles.conf.j2         , dest: "{{APACHE_CONF}}/{{WEB_APPS.5.vhost}}.conf" , var1: "{{WEB_APPS.5.vhost}}" , var2: "{{WEB_APP_BASE}}" , var3: "{{WEB_APPS.5.name}}" }
 
WAS_COPY1: 
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.0.name}}-webapp-V{{WEB_APPS.0.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.1.name}}-webapp-V{{WEB_APPS.1.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.2.name}}-webapp-V{{WEB_APPS.2.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.3.name}}-webapp-V{{WEB_APPS.3.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.4.name}}-webapp-V{{WEB_APPS.4.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.5.name}}-webapp-V{{WEB_APPS.5.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.5.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.6.name}}-webapp-V{{WEB_APPS.6.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.7.name}}-webapp-V{{WEB_APPS.7.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}" }  
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.8.name}}-webapp-V{{WEB_APPS.8.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}" }
 - { src: "/tmp/{{hostvars['localhost'].EXT_DIR}}/{{WEB_APPS.9.name}}-webapp-V{{WEB_APPS.9.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}" }  


WAS_UNARCHIVE: 
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}/{{WEB_APPS.0.name}}-webapp-V{{WEB_APPS.0.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}/{{WEB_APPS.1.name}}-webapp-V{{WEB_APPS.1.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}/{{WEB_APPS.2.name}}-webapp-V{{WEB_APPS.2.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}/{{WEB_APPS.3.name}}-webapp-V{{WEB_APPS.3.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}/{{WEB_APPS.4.name}}-webapp-V{{WEB_APPS.4.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.5.name}}/{{WEB_APPS.5.name}}-webapp-V{{WEB_APPS.5.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.5.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}/{{WEB_APPS.6.name}}-webapp-V{{WEB_APPS.6.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}/{{WEB_APPS.7.name}}-webapp-V{{WEB_APPS.7.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}" 	      , remote_src: yes}  
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}/{{WEB_APPS.8.name}}-webapp-V{{WEB_APPS.8.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}/{{WEB_APPS.9.name}}-webapp-V{{WEB_APPS.9.version}}.tar.gz" , dest: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}" 	      , remote_src: yes}  
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}/binpackage/{{WEB_APPS.0.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}/ROOT" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}/binpackage/{{WEB_APPS.1.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/ROOT" 	      , remote_src: yes} 
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}/binpackage/{{WEB_APPS.2.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}/ROOT"         , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}/binpackage/{{WEB_APPS.3.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}/ROOT" 	      , remote_src: yes} 
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}/binpackage/{{WEB_APPS.4.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}/ROOT" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.5.name}}/binpackage/{{WEB_APPS.5.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.5.name}}/ROOT" 	      , remote_src: yes} 
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}/binpackage/{{WEB_APPS.6.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/admin-stp"    , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}/binpackage/{{WEB_APPS.7.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}/binpackage/{{WEB_APPS.8.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/stats" 	      , remote_src: yes}
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}/binpackage/{{WEB_APPS.9.name}}.war"    			  , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/vocalmestre1" , remote_src: yes} 


WAS_SYNCHRONIZE:
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}/ROOT/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/ROOT/META-INF"	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}/ROOT/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}/ROOT/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}/ROOT/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.5.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.5.name}}/ROOT/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/admin-stp/META-INF"    }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/stats/META-INF" 	   }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}/conf/" , dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/vocalmestre1/META-INF" }
 
WAS_COPY2:
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.0.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.0.vhost}}/ROOT.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.1.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.1.vhost}}/ROOT.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.2.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.2.vhost}}/ROOT.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.3.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.3.vhost}}/ROOT.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.4.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.4.vhost}}/ROOT.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.6.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.6.vhost}}/admin-stp.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.7.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.7.vhost}}/adv1.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.8.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.8.vhost}}/stats.xml" 	  , remote_src: yes }
 - { src: "{{EXTRACT_DIR}}/{{WEB_APPS.9.name}}/conf/context.xml" , dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.9.vhost}}/vocalmestre1.xml" , remote_src: yes }


WAS_LINEINFILE:
# - dest: "{{TOMCAT_CONF}}/server.xml"
#   regexp: '<Connector port="8009"'
#   line: <Connector port="8009" maxThreads="800" connectionTimeout="60000" minSpareThreads="25" maxSpareThreads="75" enableLookups="false" protocol="AJP/1.3" redirectPort="8443" />

 - dest: "{{TOMCAT_CONF}}/server.xml"
   regexp: '<Engine name="Catalina" defaultHost="localhost"'
   line: <Engine name="Catalina" defaultHost="localhost" jvmRoute="localhost">

# - dest: "{{TOMCAT_CONF}}/tomcat{{TOMCAT_VERSION}}.conf"
#   regexp: 'JAVA_OPTS='
#   line: JAVA_OPTS="${JAVA_OPTS} -Xmx1536m -Xms1024m -Xmn512m -XX:MaxPermSize=512m -Djavax.sql.DataSource.Factory=org.apache.commons.dbcp.BasicDataSourceFactory"
#

WAS_BLOCKINFILE:
 
 - dest: "/etc/hosts"
   insertafter: EOF
   marker: # {mark} ANSIBLE MANAGED BLOCK #
   block: |
      {{ansible_eth1.ipv4.address}}    gv-admmsgvocale-svi-amea.dmz.cloud.mbs
      {{ansible_eth1.ipv4.address}}    gv-provisioning-amea.dmz.cloud.mbs
      {{ansible_eth1.ipv4.address}}    gv-switchingservice-amea.dmz.cloud.mbs
      {{ansible_eth1.ipv4.address}}    gv-webservices-amea.dmz.cloud.mbs
      {{ansible_eth1.ipv4.address}}    gv-svifiles-amea.dmz.cloud.mbs
      {{ansible_eth1.ipv4.address}}    {{URL}}

 - dest: "/opt/application/ivraas/{{IVRAAS_VERSION}}/apache2215/conf/httpd.conf"
   insertafter: '#CustomLog logs\/access_log common'
   marker: # {mark} ANSIBLE MANAGED BLOCK #
   block: |
     LogFormat "%a %l %u %t %v %T %k \"%r\" %>s %b %D \"%{Referer}i\" \"%{User-Agent}i\" %I %O" myformat
     CustomLog /opt/application/ivraas/current/logs/access_ivraas_log myformat

 - dest: "{{TOMCAT_CONF}}/server.xml"
   insertafter: "</Host>"
   marker: "<!-- {mark} ANSIBLE MANAGED BLOCK -->"
   block: |
      <Host name="{{WEB_APPS.1.vhost}}" appBase="{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" unpackWARs="false" autoDeploy="false" deployOnStartup="true" deployXML="false">
      <Alias>"{{DNF_AUTH_URL}}"</Alias>
      </Host>
 
      <Host name="{{WEB_APPS.0.vhost}}" appBase="{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}" unpackWARs="false" autoDeploy="false" deployOnStartup="true" deployXML="false">
      </Host>
 
      <Host name="{{WEB_APPS.3.vhost}}" appBase="{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}" unpackWARs="false" autoDeploy="false" deployOnStartup="true" deployXML="false">
      <Alias>"{{DNF_SVCS_URL}}"</Alias>
      </Host>
 
      <Host name="{{WEB_APPS.4.vhost}}" appBase="{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}" unpackWARs="false" autoDeploy="false" deployOnStartup="true" deployXML="false">
      </Host>
 
      <Host name="{{WEB_APPS.2.vhost}}" appBase="{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}" unpackWARs="false" autoDeploy="false" deployOnStartup="true" deployXML="false">
      <Alias>"{{DNF_PROV_URL}}"</Alias>
      </Host>


WAS_REPLACE:
##############################################      tomcattab      #################################################
 - dest: "/etc/tomcattab" 
   changes:
    - { regexp: '^ivraas:\/opt\/tomcat.*$' , replace: 'ivraas:/opt/tomcat/8.0.36:ivruser:/usr/java/jdk1.8.0_152:Y' }
############################################       syslog.conf        ##############################################
 - dest: "/etc/syslog.conf" 
   changes:
    - { regexp: '#\$ModLoad imudp' , replace: '$ModLoad imudp' }
    - { regexp: '#\$UDPServerRun 514' , replace: '$UDPServerRun 514' }
    - { regexp: '^local7\.\*.*' , replace: 'local7.*           /opt/application/ivraas/current/logs/webapps_ivraas_log' }
#############################################       httpd.conf        ##############################################
 - dest: "/opt/application/ivraas/{{IVRAAS_VERSION}}/apache2215/conf/httpd.conf" 
   changes:
    - { regexp: '#NameVirtualHost \*:80' , replace: 'NameVirtualHost *:80' }
    - { regexp: '#Listen ivraas-apache:80' , replace: 'Listen ivraas-apache:80' }
    - { regexp: 'ErrorLog logs/error_log' , replace: 'ErrorLog /opt/application/ivraas/current/logs/error_ivraas_log' }
    - { regexp: 'User apache' , replace: 'User ivruser' }
    - { regexp: 'Group apache' , replace: 'Group ivrgroup' }
############################################# context files in tomcat ##############################################
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.0.vhost}}/ROOT.xml" 
   changes:
    - { regexp: /usr2/web/gv-admmsgvocale-svi-amea.dmz.cloud.mbs , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.1.vhost}}/ROOT.xml"
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.2.vhost}}/ROOT.xml"
   changes:
    - { regexp: /usr2/web/gv-provisioning-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.3.vhost}}/ROOT.xml"
   changes:
    - { regexp: /usr2/web/gv-switchingservice-amea.dmz.cloud.mbs , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.4.vhost}}/ROOT.xml"
   changes:
    - { regexp: /usr2/web/gv-webservices-amea.dmz.cloud.mbs	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.6.vhost}}/admin-stp.xml"
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.7.vhost}}/adv1.xml"
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.8.vhost}}/stats.xml"
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{TOMCAT_CONF}}/Catalina/{{WEB_APPS.9.vhost}}/vocalmestre1.xml"
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
#########################################  admmsgvocale Webapp META-INF  ############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}/ROOT/META-INF/context.xml" 
   changes:   
    - { regexp: /usr2/web/gv-admmsgvocale-svi-amea.dmz.cloud.mbs , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.0.name}}/ROOT/META-INF/hibernate.cfg.xml" 
   changes:  
    - { regexp: cloud-amea02-itg.ope.cloud.mbs 			 , replace: "{{DB_VIP}}" }
############################################  authent Webapp META-INF  ##############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/ROOT/META-INF/context.xml"
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/ROOT/META-INF/hibernate.cfg.xml"
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs 	 		 , replace: "{{DB_VIP}}" }
##########################################  provisioning Webapp META-INF ############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}/ROOT/META-INF/context.xml"         
   changes:
    - { regexp: /usr2/web/gv-provisioning-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.2.name}}" }
########################################  switchingservice Webapp META-INF ##########################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}/ROOT/META-INF/context.xml"         
   changes:
    - { regexp: /usr2/web/gv-switchingservice-amea.dmz.cloud.mbs , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.3.name}}/ROOT/META-INF/application.properties"         
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs 			 , replace: "{{DB_VIP}}" }
############################################  webservice Webapp META-INF #############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}/ROOT/META-INF/context.xml"         
   changes:
    - { regexp: /usr2/web/gv-webservices-amea.dmz.cloud.mbs	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}/ROOT/META-INF/hibernate.cfg.xml"         
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.4.name}}/ROOT/META-INF/hibernateStatMaster.cfg.xml"         
   changes:
   - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
############################################  admin-stp Webapp META-INF ##############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/admin-stp/META-INF/context.xml"    
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/admin-stp/META-INF/application.properties"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
###############################################  adv Webapp META-INF #################################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/context.xml"         
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/hibernate.cfg.xml"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/hibernateStat.cfg.xml"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/hibernateStatMaster.cfg.xml"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
#################################################  stats Webapp META-INF ###############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/stats/META-INF/context.xml"        
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
# - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/stats/META-INF/application.properties"    
#   changes:
#    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
##############################################  vocalmestre Webapp META-INF ############################################
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/vocalmestre1/META-INF/context.xml" 
   changes:
    - { regexp: /usr2/web/gv-authent-amea.dmz.cloud.mbs 	 , replace: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/hibernate.cfg.xml"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/hibernateStat.cfg.xml"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }
 - dest: "{{WEB_APP_BASE}}/{{WEB_APPS.1.name}}/adv1/META-INF/hibernateStatMaster.cfg.xml"    
   changes:
    - { regexp: cloud-amea02-itg.ope.cloud.mbs	 		 , replace: "{{DB_VIP}}" }


